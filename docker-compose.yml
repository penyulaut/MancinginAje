services:
  # Laravel Application
  app:
    build:
      context: .
      dockerfile: Dockerfile
    container_name: mancinginaje_app
    restart: unless-stopped
    ports:
      - "2310:2310"
    environment:
      # ====================================
      # Application Settings
      # ====================================
      - APP_NAME=MancinginAje
      - APP_ENV=production
      - APP_KEY=${APP_KEY}
      - APP_DEBUG=false
      - APP_URL=http://localhost:2310
      - APP_TIMEZONE=Asia/Jakarta
      - APP_LOCALE=id

      # ====================================
      # Database Configuration
      # ====================================
      # SQLite (Default - no additional setup needed)
      - DB_CONNECTION=sqlite
      - DB_DATABASE=/var/www/html/database/database.sqlite
      
      # MySQL (Uncomment if using MySQL)
      # - DB_CONNECTION=mysql
      # - DB_HOST=db
      # - DB_PORT=3306
      # - DB_DATABASE=mancinginaje
      # - DB_USERNAME=mancinginaje
      # - DB_PASSWORD=secret_password

      # ====================================
      # Cache, Session & Queue
      # ====================================
      - CACHE_STORE=file
      - SESSION_DRIVER=file
      - SESSION_LIFETIME=120
      - QUEUE_CONNECTION=database
      - BROADCAST_CONNECTION=log

      # ====================================
      # Logging
      # ====================================
      - LOG_CHANNEL=stack
      - LOG_STACK=single
      - LOG_LEVEL=error

      # ====================================
      # Midtrans Payment Gateway
      # ====================================
      - MIDTRANS_MERCHANT_ID=${MIDTRANS_MERCHANT_ID}
      - MIDTRANS_CLIENT_KEY=${MIDTRANS_CLIENT_KEY}
      - MIDTRANS_SERVER_KEY=${MIDTRANS_SERVER_KEY}
      - MIDTRANS_IS_PRODUCTION=false
      - MIDTRANS_ENV=sandbox

      # ====================================
      # Biteship (Shipping API)
      # ====================================
      - BITESHIP_API_KEY=${BITESHIP_API_KEY}
      - BITESHIP_BASE_URL=https://api.biteship.com
      - BITESHIP_ORIGIN_POSTAL_CODE=${BITESHIP_ORIGIN_POSTAL_CODE}

      # ====================================
      # Pusher (Real-time Broadcasting)
      # ====================================
      - PUSHER_APP_ID=${PUSHER_APP_ID}
      - PUSHER_APP_KEY=${PUSHER_APP_KEY}
      - PUSHER_APP_SECRET=${PUSHER_APP_SECRET}
      - PUSHER_APP_CLUSTER=${PUSHER_APP_CLUSTER:-ap1}
      - PUSHER_SCHEME=https

      # ====================================
      # Mail Configuration (Optional)
      # ====================================
      - MAIL_MAILER=log
      # - MAIL_MAILER=smtp
      # - MAIL_HOST=mailpit
      # - MAIL_PORT=1025
      # - MAIL_USERNAME=null
      # - MAIL_PASSWORD=null
      # - MAIL_ENCRYPTION=null
      # - MAIL_FROM_ADDRESS="hello@mancinginaje.com"
      # - MAIL_FROM_NAME="MancinginAje"

      # ====================================
      # Redis (Uncomment if using Redis)
      # ====================================
      # - REDIS_CLIENT=predis
      # - REDIS_HOST=redis
      # - REDIS_PASSWORD=null
      # - REDIS_PORT=6379

    volumes:
      - app_storage:/var/www/html/storage
      - app_database:/var/www/html/database
    networks:
      - mancinginaje_network
    # Uncomment if using MySQL
    # depends_on:
    #   db:
    #     condition: service_healthy

  # ====================================
  # MySQL Database (Optional)
  # ====================================
  # db:
  #   image: mysql:8.0
  #   container_name: mancinginaje_db
  #   restart: unless-stopped
  #   environment:
  #     - MYSQL_ROOT_PASSWORD=root_password
  #     - MYSQL_DATABASE=mancinginaje
  #     - MYSQL_USER=mancinginaje
  #     - MYSQL_PASSWORD=secret_password
  #   volumes:
  #     - db_data:/var/lib/mysql
  #   ports:
  #     - "3307:3306"
  #   networks:
  #     - mancinginaje_network
  #   healthcheck:
  #     test: ["CMD", "mysqladmin", "ping", "-h", "localhost"]
  #     interval: 10s
  #     timeout: 5s
  #     retries: 5

  # ====================================
  # Redis Cache (Optional)
  # ====================================
  # redis:
  #   image: redis:alpine
  #   container_name: mancinginaje_redis
  #   restart: unless-stopped
  #   ports:
  #     - "6380:6379"
  #   volumes:
  #     - redis_data:/data
  #   networks:
  #     - mancinginaje_network

networks:
  mancinginaje_network:
    driver: bridge

volumes:
  app_storage:
    driver: local
  app_database:
    driver: local
  # Uncomment if using MySQL
  # db_data:
  #   driver: local
  # Uncomment if using Redis
  # redis_data:
  #   driver: local
